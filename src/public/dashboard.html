<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woodstock Enterprise Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .module-card {
            transition: all 0.3s ease;
        }
        .module-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .nav-item {
            transition: all 0.2s ease;
        }
        .nav-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .tab-btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500; color: #374151; transition: all .2s; }
        .tab-btn:hover { color: #fff; background-color: #6366F1; }
        .tab-btn.active { background-color: #4F46E5; color: #fff; }
        .hidden { display: none; }
        .badge-dot {
            width: 8px; height: 8px; border-radius: 9999px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-cube text-blue-600 text-2xl mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-900">Woodstock Enterprise</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="hamburger" class="lg:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span class="text-sm text-gray-600">Demo Tenant</span>
                    </div>
                    <button id="fullscreenBtn" class="hidden sm:inline-flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50 text-gray-700">
                        <i class="fas fa-expand"></i>
                        Fullscreen
                    </button>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-cog mr-2"></i>Settings
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-screen-2xl mx-auto">
      <div class="flex">
        <!-- Sidebar (collapsible) -->
        <aside id="sidebar" class="hidden lg:block w-64 border-r bg-white min-h-[calc(100vh-64px)]">
          <div class="p-4 border-b">
            <div class="text-xs font-semibold text-gray-500 uppercase">Navigation</div>
          </div>
          <nav class="p-3 space-y-1">
            <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 flex items-center gap-2" data-tab-link="inbox"><i class="fas fa-inbox text-gray-600"></i><span>Inbox</span></button>
            <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 flex items-center gap-2" data-tab-link="analytics"><i class="fas fa-chart-line text-gray-600"></i><span>Analytics</span></button>
            <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 flex items-center gap-2" data-tab-link="pipeline"><i class="fas fa-funnel-dollar text-gray-600"></i><span>Pipeline</span></button>
            <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 flex items-center gap-2" data-tab-link="voice"><i class="fas fa-phone text-gray-600"></i><span>Voice</span></button>
            <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 flex items-center gap-2" data-tab-link="automation"><i class="fas fa-robot text-gray-600"></i><span>Automation</span></button>
            <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 flex items-center gap-2" data-tab-link="copilot"><i class="fas fa-brain text-gray-600"></i><span>Copilot</span></button>
          </nav>
        </aside>

        <!-- Main panel -->
        <main class="flex-1 py-6 px-4 sm:px-6 lg:px-8">
          <!-- Header -->
          <div class="mb-6">
              <h2 class="text-2xl font-bold text-gray-900 mb-1">Enterprise Dashboard</h2>
              <p class="text-gray-600">Unified platform for customer engagement, automation, and business intelligence</p>
          </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <i class="fas fa-comments text-blue-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Active Conversations</p>
                        <p class="text-2xl font-semibold text-gray-900">247</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-lg">
                        <i class="fas fa-robot text-green-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Tasks Completed</p>
                        <p class="text-2xl font-semibold text-gray-900">1,847</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <i class="fas fa-chart-line text-purple-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Leads Generated</p>
                        <p class="text-2xl font-semibold text-gray-900">523</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-yellow-100 rounded-lg">
                        <i class="fas fa-phone text-yellow-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Active Numbers</p>
                        <p class="text-2xl font-semibold text-gray-900">12</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabbed Shell -->
        <div class="mb-4 flex items-center gap-2">
            <button class="tab-btn active" data-tab="inbox">Inbox <span id="inboxLiveDot" class="inline-block badge-dot ml-2 bg-gray-300 align-middle"></span></button>
            <button class="tab-btn" data-tab="analytics">Analytics</button>
            <button class="tab-btn" data-tab="pipeline">Pipeline</button>
            <button class="tab-btn" data-tab="voice">Voice</button>
            <button class="tab-btn" data-tab="automation">Automation</button>
            <button class="tab-btn" data-tab="copilot">Copilot</button>
        </div>

        <!-- Tab Panels -->
        <div id="tab-inbox" class="bg-white rounded-xl shadow p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Recent Conversations</h3>
                <a href="/inbox" class="text-indigo-600 hover:underline">Open Full Inbox →</a>
            </div>
            <div id="inboxList" class="divide-y"></div>
        </div>

        <div id="tab-analytics" class="bg-white rounded-xl shadow p-6 mb-8 hidden">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Top Customers (sample)</h3>
                <button id="refreshAnalytics" class="px-3 py-1.5 rounded bg-gray-100 hover:bg-gray-200 text-sm">Refresh</button>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">Name</th>
                            <th class="px-4 py-2 text-left">Email</th>
                            <th class="px-4 py-2 text-left">Phone</th>
                            <th class="px-4 py-2 text-right">Total Spent</th>
                        </tr>
                    </thead>
                    <tbody id="analyticsTopCustomers"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-pipeline" class="bg-white rounded-xl shadow p-6 mb-8 hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Lead Pipeline</h3>
            <p class="text-gray-600 mb-4">Kanban board placeholder. We will wire live data next.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="border rounded p-3"><h4 class="font-semibold mb-2">New</h4><div id="col-new" class="space-y-2 text-gray-700"></div></div>
                <div class="border rounded p-3"><h4 class="font-semibold mb-2">Qualified</h4><div id="col-qualified" class="space-y-2 text-gray-700"></div></div>
                <div class="border rounded p-3"><h4 class="font-semibold mb-2">Won</h4><div id="col-won" class="space-y-2 text-gray-700"></div></div>
            </div>
        </div>

        <div id="tab-voice" class="bg-white rounded-xl shadow p-6 mb-8 hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Voice Management</h3>
            <p class="text-gray-600">Connect Twilio/Vapi later. For now, open dedicated module.</p>
            <a href="/voice" class="inline-block mt-3 px-4 py-2 rounded bg-indigo-600 text-white">Open Voice Module</a>
        </div>

        <div id="tab-automation" class="bg-white rounded-xl shadow p-6 mb-8 hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Automation</h3>
            <p class="text-gray-600">Agents and headless tasks. Open dedicated module for now.</p>
            <a href="/automation" class="inline-block mt-3 px-4 py-2 rounded bg-indigo-600 text-white">Open Automation Module</a>
        </div>

        <div id="tab-copilot" class="bg-white rounded-xl shadow p-6 mb-8 hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">AI Copilot</h3>
            <div class="flex gap-2 items-end mb-4">
                <div class="flex-1">
                    <label class="block text-sm text-gray-600 mb-1">Function</label>
                    <select id="copilotFunction" class="w-full border rounded px-3 py-2 text-sm"></select>
                </div>
                <div class="flex-1">
                    <label class="block text-sm text-gray-600 mb-1">Parameters (JSON)</label>
                    <textarea id="copilotParams" class="w-full border rounded px-3 py-2 text-sm" rows="3">{}</textarea>
                </div>
                <button id="runCopilot" class="px-4 py-2 rounded bg-indigo-600 text-white">Run</button>
            </div>
            <pre id="copilotResult" class="bg-gray-50 border rounded p-3 text-xs overflow-auto"></pre>
        </div>

        <!-- Module Grid (hidden in SaaS shell) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
            <!-- Unified Inbox -->
            <div class="module-card bg-white rounded-xl shadow-lg p-6 cursor-pointer" onclick="navigateToModule('/inbox')">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-blue-100 rounded-lg">
                        <i class="fas fa-inbox text-blue-600 text-2xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Live</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Unified Inbox</h3>
                <p class="text-gray-600 mb-4">Manage conversations across webchat, Facebook, Instagram, and SMS in one place.</p>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">247 active conversations</span>
                    <i class="fas fa-arrow-right text-blue-600"></i>
                </div>
            </div>

            <!-- Voice Management -->
            <div class="module-card bg-white rounded-xl shadow-lg p-6 cursor-pointer" onclick="navigateToModule('/voice')">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <i class="fas fa-phone text-green-600 text-2xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">Migrating</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Voice Management</h3>
                <p class="text-gray-600 mb-4">AI call centers with Twilio numbers, Vapi assistants, and analytics.</p>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">12 active numbers</span>
                    <i class="fas fa-arrow-right text-green-600"></i>
                </div>
            </div>

            <!-- Browser Automation -->
            <div class="module-card bg-white rounded-xl shadow-lg p-6 cursor-pointer" onclick="navigateToModule('/automation')">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <i class="fas fa-robot text-purple-600 text-2xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">Migrating</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Browser Automation</h3>
                <p class="text-gray-600 mb-4">AI agents executing web tasks, lead generation, and business automation.</p>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">15 tasks in queue</span>
                    <i class="fas fa-arrow-right text-purple-600"></i>
                </div>
            </div>

            <!-- Analytics Platform -->
            <div class="module-card bg-white rounded-xl shadow-lg p-6 cursor-pointer" onclick="navigateToModule('/analytics')">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-yellow-100 rounded-lg">
                        <i class="fas fa-chart-bar text-yellow-600 text-2xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">Migrating</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Analytics Platform</h3>
                <p class="text-gray-600 mb-4">Chat with your data, conversation insights, and business intelligence.</p>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">247k data points</span>
                    <i class="fas fa-arrow-right text-yellow-600"></i>
                </div>
            </div>

            <!-- Lead Pipeline -->
            <div class="module-card bg-white rounded-xl shadow-lg p-6 cursor-pointer" onclick="navigateToModule('/pipeline')">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-red-100 rounded-lg">
                        <i class="fas fa-funnel-dollar text-red-600 text-2xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded-full">Building</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Lead Pipeline</h3>
                <p class="text-gray-600 mb-4">AI-powered kanban board with automatic lead progression and scoring.</p>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">523 active leads</span>
                    <i class="fas fa-arrow-right text-red-600"></i>
                </div>
            </div>

            <!-- AI Copilot -->
            <div class="module-card bg-white rounded-xl shadow-lg p-6 cursor-pointer" onclick="navigateToModule('/copilot')">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-indigo-100 rounded-lg">
                        <i class="fas fa-brain text-indigo-600 text-2xl"></i>
                    </div>
                    <span class="px-3 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded-full">Building</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">AI Copilot</h3>
                <p class="text-gray-600 mb-4">Your personal Jarvis - connects to everything, automates anything.</p>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">∞ possibilities</span>
                    <i class="fas fa-arrow-right text-indigo-600"></i>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="mt-12">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>
            <div class="bg-white rounded-lg shadow">
                <div class="p-6">
                    <div class="flow-root">
                        <ul class="-mb-8">
                            <li>
                                <div class="relative pb-8">
                                    <div class="relative flex space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center">
                                                <i class="fas fa-comments text-white text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500">New conversation started in <span class="font-medium text-gray-900">Unified Inbox</span></p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500">2 min ago</div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="relative pb-8">
                                    <div class="relative flex space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center">
                                                <i class="fas fa-robot text-white text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500">Automation task completed: <span class="font-medium text-gray-900">Lead research</span></p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500">5 min ago</div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="relative">
                                    <div class="relative flex space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="h-8 w-8 rounded-full bg-purple-500 flex items-center justify-center">
                                                <i class="fas fa-funnel-dollar text-white text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500">Lead moved to <span class="font-medium text-gray-900">Qualified</span> stage</p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500">8 min ago</div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        </main>
      </div>
    </div>

    <script>
        function navigateToModule(path) {
            window.location.href = path;
        }

        // Add some interactivity
        document.addEventListener('DOMContentLoaded', function() {
            // Animate stats on load
            const stats = document.querySelectorAll('.text-2xl.font-semibold');
            stats.forEach(stat => {
                const finalValue = parseInt(stat.textContent.replace(/[^0-9]/g, ''));
                let currentValue = 0;
                const increment = finalValue / 50;
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        stat.textContent = finalValue.toLocaleString();
                        clearInterval(timer);
                    } else {
                        stat.textContent = Math.floor(currentValue).toLocaleString();
                    }
                }, 20);
            });

            initSidebar();
            initTabs();
            initInbox();
            initAnalytics();
            initCopilot();
            initSSE();
            initFullscreen();
        });

        function initSidebar() {
            const btn = document.getElementById('hamburger');
            const sidebar = document.getElementById('sidebar');
            const links = Array.from(document.querySelectorAll('[data-tab-link]'));
            btn?.addEventListener('click', () => sidebar.classList.toggle('hidden'));
            links.forEach(l => l.addEventListener('click', () => {
                showTab(l.getAttribute('data-tab-link'));
                if (!sidebar.classList.contains('lg:block')) sidebar.classList.add('hidden');
            }));
        }

        function initTabs() {
            const buttons = Array.from(document.querySelectorAll('.tab-btn'));
            buttons.forEach(btn => btn.addEventListener('click', () => showTab(btn.dataset.tab)));
            showTab('inbox');
        }

        function showTab(tab) {
            const buttons = Array.from(document.querySelectorAll('.tab-btn'));
            buttons.forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
            const panels = ['inbox','analytics','pipeline','voice','automation','copilot'];
            panels.forEach(id => {
                document.getElementById('tab-' + id).classList.toggle('hidden', id !== tab);
            });
        }

        async function fetchJson(url, options) {
            try { const r = await fetch(url, options); return await r.json(); } catch { return null; }
        }

        async function initInbox() {
            const box = document.getElementById('inboxList');
            box.innerHTML = '<div class="text-gray-500">Loading…</div>';
            const res = await fetchJson('/api/inbox/conversations?limit=10');
            if (!res || res.status !== 'success' || !Array.isArray(res.data)) {
                box.innerHTML = '<div class="text-red-600">Failed to load conversations.</div>';
                return;
            }
            box.innerHTML = res.data.map(row => {
                const last = (row.last_message_content || '').replace(/<[^>]+>/g,'');
                return `
                <div class="py-3 flex items-start justify-between">
                  <div>
                    <div class="text-sm font-medium text-gray-900">${row.platform_type} • ${row.user_identifier}</div>
                    <div class="text-sm text-gray-600 truncate max-w-[56ch]">${last || '(no message)'}</div>
                  </div>
                  <a class="text-indigo-600 text-sm hover:underline" href="/inbox">View</a>
                </div>`;
            }).join('');
        }

        async function initAnalytics() {
            const btn = document.getElementById('refreshAnalytics');
            btn.addEventListener('click', loadTopCustomers);
            loadTopCustomers();
        }

        async function loadTopCustomers() {
            const tbody = document.getElementById('analyticsTopCustomers');
            tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">Loading…</td></tr>';
            const res = await fetchJson('/api/customers');
            if (!res || res.status !== 'success' || !Array.isArray(res.data)) {
                tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-6 text-center text-red-600">Failed to load.</td></tr>';
                return;
            }
            const rows = res.data.slice(0, 8).map(c => `
                <tr class="border-t">
                  <td class="px-4 py-2">${[c.firstname,c.lastname].filter(Boolean).join(' ')}</td>
                  <td class="px-4 py-2">${c.email || ''}</td>
                  <td class="px-4 py-2">${c.phonenumber || ''}</td>
                  <td class="px-4 py-2 text-right">$${(c.total_spent||0).toLocaleString()}</td>
                </tr>
            `).join('');
            tbody.innerHTML = rows || '<tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">No data.</td></tr>';
        }

        async function initCopilot() {
            const sel = document.getElementById('copilotFunction');
            const run = document.getElementById('runCopilot');
            const out = document.getElementById('copilotResult');
            const params = document.getElementById('copilotParams');
            const list = await fetchJson('/api/functions');
            const funcs = Array.isArray(list?.functions) ? list.functions : [];
            sel.innerHTML = funcs.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            run.addEventListener('click', async () => {
                out.textContent = 'Running…';
                let parsed = {};
                try { parsed = JSON.parse(params.value || '{}'); } catch { out.textContent = 'Invalid JSON in parameters.'; return; }
                const r = await fetch('/api/functions/execute', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ functionName: sel.value, parameters: parsed })
                });
                const j = await r.json().catch(() => ({}));
                out.textContent = JSON.stringify(j, null, 2);
            });
        }

        function initSSE() {
            try {
                const dot = document.getElementById('inboxLiveDot');
                const es = new EventSource('/api/inbox/stream');
                es.onmessage = () => {
                    dot.classList.remove('bg-gray-300');
                    dot.classList.add('bg-green-500');
                    // Optionally refresh inbox if tab visible
                    if (!document.getElementById('tab-inbox').classList.contains('hidden')) {
                        initInbox();
                    }
                };
                es.onerror = () => {
                    dot.classList.remove('bg-green-500');
                    dot.classList.add('bg-red-500');
                };
            } catch {}
        }

        function initFullscreen() {
            const btn = document.getElementById('fullscreenBtn');
            btn?.addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                const isHidden = sidebar.classList.contains('hidden') || !getComputedStyle(sidebar).display || getComputedStyle(sidebar).display === 'none';
                if (isHidden) {
                    sidebar.classList.remove('hidden');
                    btn.innerHTML = '<i class="fas fa-expand"></i> Fullscreen';
                } else {
                    sidebar.classList.add('hidden');
                    btn.innerHTML = '<i class="fas fa-compress"></i> Exit Fullscreen';
                }
            });
        }
    </script>
</body>
</html>
